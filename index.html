<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Unit 1 Ëã±Ë™û‰∫íÂãïÁ´ô - AnnyËÄÅÂ∏´</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary: #4A90E2; --secondary: #F5A623; --success: #7ED321; --danger: #FF5E5E; --bg: #F0F4F8;
        }
        * { touch-action: manipulation; box-sizing: border-box; }
        body {
            font-family: -apple-system, sans-serif; background-color: var(--bg); margin: 0;
            display: flex; flex-direction: column; align-items: center; min-height: 100vh;
        }
        nav {
            width: 100%; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex; justify-content: center; gap: 8px; padding: 12px 5px; position: sticky; top: 0; z-index: 100;
        }
        .nav-btn {
            flex: 1; max-width: 100px; padding: 10px 0; border-radius: 12px; border: 2px solid var(--primary);
            background: transparent; color: var(--primary); font-weight: bold; font-size: 0.9rem;
        }
        .nav-btn.active { background: var(--primary); color: white; }
        .container { width: 95%; max-width: 450px; margin-top: 20px; display: none; flex-direction: column; align-items: center; padding-bottom: 30px; }
        .container.active { display: flex; }
        .card {
            background: white; width: 100%; border-radius: 20px; padding: 25px 20px;
            box-shadow: 0 8px 15px rgba(0,0,0,0.05); text-align: center; margin-bottom: 20px;
            min-height: 280px; display: flex; flex-direction: column; justify-content: center;
        }
        .word { font-size: 2.2rem; color: var(--primary); font-weight: bold; margin-bottom: 8px; }
        .pos { color: #888; font-style: italic; margin-bottom: 15px; }
        .def-ch { font-size: 1.25rem; color: #222; font-weight: 500; border-top: 1px solid #eee; padding-top: 15px; }
        .btn-group { display: flex; flex-direction: column; gap: 10px; width: 100%; }
        button { min-height: 55px; border: none; border-radius: 15px; font-size: 1.1rem; font-weight: bold; cursor: pointer; }
        .btn-speak { background: var(--secondary); color: white; }
        .btn-practice { background: var(--primary); color: white; }
        .btn-next { background: #333; color: white; }
        #match-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; }
        .match-item {
            background: white; padding: 12px 8px; border-radius: 12px; text-align: center;
            border: 2px solid transparent; box-shadow: 0 3px 6px rgba(0,0,0,0.05);
            min-height: 75px; display: flex; align-items: center; justify-content: center; font-size: 0.95rem;
        }
        .match-item.selected { border-color: var(--primary); background: #E1F0FF; }
        .match-item.correct { background: #E8F5E9; color: #BBB; }
        .match-item.wrong { background: #FFEBEE; border-color: var(--danger); }
        .feedback { margin-top: 15px; min-height: 60px; font-weight: bold; font-size: 1.2rem; text-align: center; line-height: 1.4; }
        .wrong-text { color: var(--danger); font-size: 0.9rem; display: block; margin-top: 5px; font-weight: normal; }
    </style>
</head>
<body>

    <nav>
        <button class="nav-btn active" id="btn-learn" onclick="showPage('learn')">Learn</button>
        <button class="nav-btn" id="btn-game" onclick="showPage('game')">Game</button>
        <button class="nav-btn" id="btn-match" onclick="showPage('match')">Match</button>
    </nav>

    <div id="learn" class="container active">
        <div class="card" id="learn-card"></div>
        <div class="btn-group">
            <button class="btn-speak" onclick="handleSpeak()">üîä Listen (ËÅΩ)</button>
            <button class="btn-practice" onclick="handlePractice()">üé§ Practice (Á∑¥Áøí)</button>
            <div id="learn-feedback" class="feedback"></div>
            <button class="btn-next" onclick="nextLearnWord()">Next ÂñÆÂ≠ó ‚Üí</button>
        </div>
        <p id="progress-text" style="margin-top:15px; color:#999; font-size: 0.8rem;"></p>
    </div>

    <div id="game" class="container">
        <div style="font-weight:bold; margin-bottom:5px;">Score: <span id="current-score">0</span></div>
        <div id="timer" style="color:red; font-weight:bold; font-size:1.2rem;">Time Left: <span id="seconds">60</span>s</div>
        <div class="card">
            <div id="game-word" class="word">READY?</div>
            <div id="game-feedback" class="feedback"></div>
        </div>
        <button id="start-btn" onclick="startGame()" style="background: var(--success); color: white; width: 100%;">START CHALLENGE</button>
    </div>

    <div id="match" class="container">
        <div style="font-weight:bold; margin-bottom:10px;">Time: <span id="match-seconds">0</span>s</div>
        <div id="match-grid"></div>
        <button onclick="startMatchGame()" style="background: var(--primary); color: white; margin-top: 20px; width: 100%;">New Match</button>
    </div>

    <script>
        const vocabulary = [
            { word: "transportation", pos: "n.[U]", def_ch: "‰∫§ÈÄöÈÅãËº∏(Á≥ªÁµ±)" },
            { word: "transport", pos: "vt.", def_ch: "ÈÅãËº∏, ÈÅãÈÄÅ" },
            { word: "project", pos: "n.[C]", def_ch: "Â∞àÊ°à, Ë®àÁï´" },
            { word: "subway", pos: "n.[C]", def_ch: "Âú∞Èêµ" },
            { word: "system", pos: "n.[C]", def_ch: "Á≥ªÁµ±, Âà∂Â∫¶" },
            { word: "explore", pos: "vt.", def_ch: "Êé¢Á¥¢, ÂãòÊé¢" },
            { word: "exploration", pos: "n.[C]", def_ch: "Êé¢Á¥¢, Êé¢Á©∂" },
            { word: "century", pos: "n.[C]", def_ch: "‰∏ñÁ¥Ä" },
            { word: "trace", pos: "vt. / n.[C]", def_ch: "ËøΩÊ∫Ø / Ëπ§Ë∑°, ÁóïË∑°" },
            { word: "unique", pos: "adj.", def_ch: "Áç®ÁâπÁöÑ" },
            { word: "attitude", pos: "n.[C]", def_ch: "ÊÖãÂ∫¶, ÁúãÊ≥ï" },
            { word: "guide", pos: "n.[C] / vt.", def_ch: "Â∞éÈÅä / ÊåáÂºï, È†òË∑Ø" },
            { word: "jam", pos: "vt. / n.[C]", def_ch: "‰ΩøÊì†Êªø / Â†µÂ°û" },
            { word: "tunnel", pos: "n.[C]", def_ch: "ÈößÈÅì, Âú∞ÈÅì" },
            { word: "drip", pos: "vi. / n.[C]", def_ch: "Êª¥‰∏ã / Ê∞¥Êª¥" },
            { word: "propose", pos: "vt.", def_ch: "ÊèêË≠∞, Âª∫Ë≠∞" },
            { word: "proposal", pos: "n.[C]", def_ch: "ÊèêÊ°à, Ë®àÁï´" },
            { word: "mile", pos: "n.[C]", def_ch: "Ëã±Èáå" },
            { word: "construction", pos: "n.[U]", def_ch: "Âª∫Ë®≠, Âª∫ÈÄ†" },
            { word: "construct", pos: "vt.", def_ch: "Âª∫ÈÄ†, ÊßãÁØâ" },
            { word: "accept", pos: "vt.", def_ch: "Êé•Âèó" },
            { word: "acceptable", pos: "adj.", def_ch: "ÂèØ‰ª•Êé•ÂèóÁöÑ" },
            { word: "horn", pos: "n.[C]", def_ch: "(ËªäËºõÁöÑ)ÂñáÂè≠" },
            { word: "track", pos: "n.[C] / vt.", def_ch: "ÈêµËªå / ËøΩËπ§" }
        ];

        let currentIdx = 0;
        const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
        const rec = new Speech();
        rec.lang = 'en-US';
        rec.interimResults = false;

        function showPage(id) {
            document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.getElementById('btn-'+id).classList.add('active');
            if(id === 'learn') updateLearn();
            if(id === 'match') startMatchGame();
            if(id !== 'game') { gameActive = false; rec.stop(); }
        }

        function updateLearn() {
            const d = vocabulary[currentIdx];
            document.getElementById('learn-card').innerHTML = `<div class="word">${d.word}</div><div class="pos">${d.pos}</div><div class="def-ch">${d.def_ch}</div>`;
            document.getElementById('learn-feedback').innerHTML = "";
            document.getElementById('progress-text').innerText = `${currentIdx + 1} / ${vocabulary.length}`;
        }
        function nextLearnWord() { currentIdx = (currentIdx + 1) % vocabulary.length; updateLearn(); }
        function handleSpeak() {
            const m = new SpeechSynthesisUtterance(vocabulary[currentIdx].word);
            m.lang = 'en-US'; window.speechSynthesis.speak(m);
        }
        function handlePractice() {
            const fb = document.getElementById('learn-feedback');
            fb.innerHTML = "Listening... üé§"; fb.style.color = "var(--primary)";
            rec.start();
            rec.onresult = (e) => {
                const text = e.results[0][0].transcript.toLowerCase();
                const target = vocabulary[currentIdx].word.toLowerCase();
                if(text.includes(target)) {
                    fb.innerHTML = `Great job! ‚ú®`; fb.style.color = "var(--success)";
                } else {
                    fb.innerHTML = `Try again! ‚ùå<span class="wrong-text">‰Ω†Ë™™ÁöÑÊòØ: "${text}"</span>`;
                    fb.style.color = "var(--danger)";
                }
            };
        }

        let gameScore = 0, timeLeft = 60, gameActive = false, gWord = "";
        function startGame() {
            gameScore = 0; timeLeft = 60; gameActive = true;
            document.getElementById('current-score').innerText = gameScore;
            document.getElementById('start-btn').style.display = 'none';
            document.getElementById('game-feedback').innerHTML = "Speak the word!";
            const timer = setInterval(() => {
                timeLeft--; document.getElementById('seconds').innerText = timeLeft;
                if(timeLeft <= 0 || !gameActive) { clearInterval(timer); if(timeLeft<=0) endG(); }
            }, 1000);
            nextG();
        }
        function nextG() {
            if(!gameActive) return;
            gWord = vocabulary[Math.floor(Math.random()*vocabulary.length)].word;
            document.getElementById('game-word').innerText = gWord;
            document.getElementById('game-feedback').innerHTML = "Listening... üé§";
            document.getElementById('game-feedback').style.color = "var(--primary)";
            rec.start();
            rec.onresult = (e) => {
                const text = e.results[0][0].transcript.toLowerCase();
                const gf = document.getElementById('game-feedback');
                if(text.includes(gWord.toLowerCase())) {
                    gameScore += 10;
                    document.getElementById('current-score').innerText = gameScore;
                    gf.innerHTML = "Correct! ‚ú®"; gf.style.color = "var(--success)";
                    setTimeout(() => { if(gameActive) { gf.innerHTML = ""; nextG(); } }, 500);
                } else {
                    gf.innerHTML = `Try Again!<br><span class="wrong-text">‰Ω†Ë™™ÁöÑÊòØ: "${text}"</span>`;
                    gf.style.color = "var(--danger)";
                    setTimeout(() => { if(gameActive) rec.start(); }, 800);
                }
            };
        }
        function endG() {
            gameActive = false; document.getElementById('start-btn').style.display = 'block';
            document.getElementById('game-word').innerText = "FINISH!";
            document.getElementById('game-feedback').innerHTML = `Final Score: ${gameScore}`;
            confetti({ particleCount: 200, spread: 80, origin: { y: 0.6 } });
            alert(`ÊôÇÈñìÂà∞ÔºÅÊúÄÁµÇÂæóÂàÜÔºö${gameScore}`);
        }

        let mTimer, mSecs = 0, sel = null, mFound = 0;
        function startMatchGame() {
            clearInterval(mTimer); mSecs = 0; mFound = 0; sel = null;
            mTimer = setInterval(() => { mSecs++; document.getElementById('match-seconds').innerText = mSecs; }, 1000);
            const sub = [...vocabulary].sort(() => 0.5 - Math.random()).slice(0, 5);
            let items = [];
            sub.forEach(v => {
                items.push({ id: v.word+v.pos, text: `${v.word}\n(${v.pos})`, type: 'en' });
                items.push({ id: v.word+v.pos, text: v.def_ch, type: 'ch' });
            });
            items.sort(() => 0.5 - Math.random());
            const grid = document.getElementById('match-grid');
            grid.innerHTML = '';
            items.forEach(i => {
                const d = document.createElement('div');
                d.className = 'match-item'; d.innerText = i.text;
                d.onclick = () => {
                    if(d.classList.contains('correct')) return;
                    if(!sel) { sel = { d, i }; d.classList.add('selected'); }
                    else {
                        if(sel.d === d) { d.classList.remove('selected'); sel = null; return; }
                        if(sel.i.id === i.id && sel.i.type !== i.type) {
                            d.classList.add('correct'); sel.d.classList.add('correct');
                            sel.d.classList.remove('selected'); mFound++; sel = null;
                            if(mFound === 5) { clearInterval(mTimer); confetti({particleCount:150, spread:70}); setTimeout(() => alert(`ÂÆåÊàêÔºÅËä±‰∫Ü ${mSecs} Áßí`), 500); }
                        } else {
                            d.classList.add('wrong'); sel.d.classList.add('wrong');
                            setTimeout(() => { d.classList.remove('wrong', 'selected'); sel.d.classList.remove('wrong', 'selected'); sel = null; }, 500);
                        }
                    }
                };
                grid.appendChild(d);
            });
        }
        updateLearn();
    </script>
</body>
</html>
